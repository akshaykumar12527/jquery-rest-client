!function(t){t.RestClient=function(e,r){"object"==typeof e?r={api:e}:"object"==typeof r?r.api=e:r={api:e};var i=t.extend({waitingTime:300,waitLoopLimit:60,logger:0,fnError:function(t){},setup:{cache:!1,dataType:"json",headers:{}}},r||{}),n=function(t){i.logger<=1&&console.log("API: "+t)},h=function(t){i.logger<=2&&console.error("API: "+t)},s=function(t){h(t),i.fnError(t)},u={},c=null,o=0,a=function(e,r){var h=e.parent>-1&&e.waiting?e.waiting:c;if(!h||u[h]){var o=t.extend({method:e.current.method,url:i.api+"/"+e.url+e.current.path,success:r||null,cache:i.cache,headers:e.current.headers},i.setup||{});return"POST"==e.current.method||"PUT"==e.current.method?o.data=JSON.stringify(e.current.data):"GET"==e.current.method&&(o.data=t.extend(e.current.query||{},e.current.data||{})),"/"==o.url.slice(-1)&&(o.url=o.url.slice(0,-1),console.log(o)),t.ajax(o)}if(n("Trying... "+e.key),!(e.waitingCount<i.waitLoopLimit))return s("Wait too long, canceled operation. ["+e.key+":"+e.section+"]");var d=function(){++e.waitingCount,a(e,r)};setTimeout(d,i.waitingTime)},d=function(e,r){return this.waitingCount=0,this.section=e,this.url=r,this.parent=-1,this.waiting=null,this.key=o++,this.current=this.currentClean={method:null,query:null,data:null,path:"",headers:{}},this.childrens=[],this.wait=function(t){return!0===u[t]?this:(u[t]=!1,this.parent>-1?(n("WAIT REGISTRY IN PARENT: "+t+" by "+this.key),this.waiting=t):(n("WAIT REGISTRY WHIOUT PARENT: "+t+" by "+this.key),c=t),this)},this.release=function(t){return u[t]=!0,n("WAIT UNREGISTRED: "+t+" by "+this.key),this},this.setApi=function(t){return i.api=r=t,this},this.add=function(t,e){if("object"!=typeof t){this.childrens.push(t);var r=e||t;this.url&&(r=this.url+"/"+r),this[t]=new d(t,r),this[t].parent=this.key}else for(var i in t)this.add(i,t[i])},this.query=function(t,e){return"object"==typeof t?this.current.query=t:(this.current.query={},this.current.query[t]=e),this.current.method||(this.current.method="GET"),this},this.data=function(t,e){return"object"==typeof t?this.current.data=t:(this.current.data={},this.current.data[t]=e),this.current.method||(this.current.method="POST"),this},this.defaultHeaders=function(e){return i.setup.headers=t.extend(i.setup.headers,e||{}),this},this.headers=function(e){return this.current.headers=t.extend(this.current.headers,e||{}),this},this.method=function(t){return this.current.method=t,this},this.isPost=function(){return this.current.method="POST",this},this.isGet=function(){return this.current.method="GET",this},this.isPut=function(){return this.current.method="PUT",this},this.isDelete=function(){return this.current.method="DELETE",this},this.token=function(t){return this.defaultHeaders({Authorization:"Bearer "+t}),this},this.setUrl=function(t){return this.url=t,this},this.clear=function(t){t?current=currentClean:(this.current.query=null,this.current.data=null,this.current.method=null,this.current.path="")},this.error=function(t){i.fnError=t},this.read=function(t){return this.clear(),"object"==typeof t?(this.current.query=t,this.current.path=""):this.current.path="/"+t,this.current.method="GET",this},this.create=function(t){return this.clear(),this.current.data=t,this.current.method="POST",this},this.update=function(t){return this.clear(),this.current.data=t,this.current.method="PUT",this},this.delete=function(t){return this.clear(),this.current.path="/"+t,this.current.method="DELETE",this},this.custom=function(t){return this.current={method:t.method||null,query:t.query||null,data:t.data||null,path:t.path||"",headers:t.headers||{}},this},this.get=this.read,this.post=this.create,this.put=this.update,this.insert=this.create,this.del=this.delete,this.remove=this.delete,this.destroy=this.delete,this.then=function(t){return n("Run the "+this.key),a(this,t)},this.exec=function(t){return n("Run the "+this.key),a(this)},this};return d(i.api)}}(jQuery);